<!DOCTYPE html>
<!-- saved from url=(0051)http://www.atatech.org/articles/19071?rnd=598849306 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>iOS 内核驱动分析</title>
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://www.atatech.org/assets/app-714e89bf8406edd8450de0e09e22ae3766b2b9b9.css">
    <script src="./iOS 内核驱动分析_files/app-b6a325c0b74907fbb443fd62aca552cbf3a3619c.js" data-main="article/show"></script>
    <script>require('main')</script>
    <!--[if lt IE 9]>
    <script src="/js/html5shiv-3.7.0.min.js"></script>
    <script src="/js/respond-1.4.2.min.js"></script>
    <![endif]-->
  </head>
  <body class="">
              <header>
  <div class="navbar navbar-default">
    <div class="container">
        <ul class="nav navbar-nav">
          <li><a href="http://www.atatech.org/square/">首页</a></li>
          <li><a href="http://www.atatech.org/articles/?sort=yuan">文章</a></li>
          <li><a href="http://www.atatech.org/ask">问答</a></li>
          <li class="divider"></li>
          <li><a href="http://www.atatech.org/groups/">圈子</a></li>
          <li><a href="http://www.atatech.org/teams/">团队博客</a></li>
          <li><a href="http://www.atatech.org/rookie/">新人专区</a></li>
          <li><a href="http://www.atatech.org/databoard/" target="_blank">数据看板</a></li>
          <li><a href="http://www.atatech.org/field/security/">安全领域</a></li>
        </ul>
        <ul class="nav navbar-nav pull-right">
          <li><a href="http://www.atatech.org/notifications/">消息</a></li>
          <li><a href="http://www.atatech.org/feed/">动态</a></li>
          <li class="divider"></li>
          <li class="dropdown">
            <a href="http://www.atatech.org/users/147617#information" class="navbar-avatar" data-toggle="dropdown">
              <img src="./iOS 内核驱动分析_files/u_identicon_1e4c9aea2f6c57a2d2fabfe925dad976.png_40x40" width="20" height="20" alt="英铮" class="img-circle">
              <span>&nbsp;英铮</span>
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" role="menu">
              <li>
                <a href="http://www.atatech.org/users/147617/own#information">
                <span class="glyphicon glyphicon-edit"></span>
                <span>我的文章</span>
                </a>
              </li>
              <li>
                <a href="http://www.atatech.org/users/147617/ask#information">
                <span class="glyphicon glyphicon-question-sign"></span>
                <span>我的问题</span>
                </a>
              </li>
              <li>
                <a href="http://www.atatech.org/users/147617/mark#information">
                <span class="glyphicon glyphicon-star-empty"></span>
                <span>我的收藏</span>
                </a>
              </li>
              <li>
                <a href="http://www.atatech.org/settings/">
                <span class="glyphicon glyphicon-cog"></span>
                <span>个人设置</span>
                </a>
              </li>
                            <li class="divider"></li>
              <li>
                <a href="http://www.atatech.org/logout" data-method="post">
                <span class="glyphicon glyphicon-log-out"></span>
                <span>退出</span>
                </a>
              </li>
            </ul><!-- /.dropdown -->
          </li>
          <li class="dropdown quick-search">
            <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-search"></span></button>
            <div class="dropdown-menu form-group" role="menu">
              <form action="http://www.atatech.org/search" method="get" class="quick-form">
                    <input type="hidden" name="type" value="ARTICLE">
                    <input type="text" name="q" class="form-control" placeholder="全站搜索">
                    <button type="submit" class="quick_btn"></button>
              </form>
            </div>
          </li>
        </ul>
    </div>
  </div>
  
  </header>                <div class="container">
          </div>
        

<div class="container"><div class="_article-container">
    <div class="_article-flag hidden-xs">
        <span class="glyphicon glyphicon-heart"></span>
    <span class="_article-flag-text">荐</span>
  </div>
    <div class="_article-ribbons hidden-xs">
        <div class="_article-ribbon _article-ribbon-warning">
      <span class="glyphicon glyphicon-pushpin"></span>
      <span class="_article-ribbon-text">圈内置顶</span>
    </div>
            <div class="_article-ribbon _article-ribbon-danger">
      <span class="glyphicon glyphicon-lock"></span>
      <span class="_article-ribbon-text">内部资料请勿外传</span>
    </div>
            <div class="_article-ribbon _article-ribbon-info">
            <span class="glyphicon glyphicon-leaf"></span>
      <span class="_article-ribbon-text">作者原创</span>
    </div>
          </div>
  <div class="_article-box" role="main">
    <article class="_article">
      <header class="heading">
        <h1 class="title clearfix unsafe">
          <span class="highlight">
            iOS 内核驱动分析
                      </span>
        </h1>
        <div class="infos clearfix">
          <a href="http://www.atatech.org/users/79564" class="info" title="耀刺"><img src="./iOS 内核驱动分析_files/u_identicon_976f26e16f52c34681b9c02a07a99974.png_80x80" width="32" height="32" alt="耀刺" class="img-user"><span>&nbsp;耀刺</span></a>                    <span class="info">浏览 306</span>
          <span class="info">
                        <time class="" datetime="2014-07-11T13:23:46+08:00">2014-07-11 13:23:46</time>
          </span>
                          <span class="info">发表于：<a href="http://www.atatech.org/groups/1183">无线安全无极限</a></span>
                    
          <div class="pull-right">
                        
                        
                      </div>
        </div>

                <div class="labels">
    <form accept-charset="UTF-8" action="http://www.atatech.org/articles/19071/tags" autocomplete="off" method="post" data-remote="true" data-done="$(this).closest(&#39;.labels&#39;).replaceWith(r);$.alert(&#39;修改成功&#39;, &#39;success&#39;)" style="display:none">
    <input type="hidden" name="_method" value="put">
    <div class="form-group">
      <input type="text" name="tags" class="form-control selectized" value="" tabindex="-1" style="display: none;"><div class="selectize-control form-control multi plugin-remove_button"><div class="selectize-input items not-full"><input type="text" autocomplete="off" tabindex="" style="width: 4px;"></div><div class="selectize-dropdown form-control multi plugin-remove_button" style="display: none;"><div class="selectize-dropdown-content"><div data-value="Java核心技术" data-selectable="" class="option active">Java核心技术</div><div data-value="Java" data-selectable="" class="option">Java</div><div data-value="架构" data-selectable="" class="option">架构</div><div data-value="前端与交互设计" data-selectable="" class="option">前端与交互设计</div><div data-value="分布式系统与计算" data-selectable="" class="option">分布式系统与计算</div><div data-value="算法" data-selectable="" class="option">算法</div><div data-value="数据存储与数据库" data-selectable="" class="option">数据存储与数据库</div><div data-value="测试技术" data-selectable="" class="option">测试技术</div><div data-value="编程语言" data-selectable="" class="option">编程语言</div></div></div></div>
    </div>
    <div class="form-group text-right">
      <button type="button" class="btn btn-default btn-sm" onclick="$(this).closest(&#39;.labels&#39;).children().toggle()">取消</button>
      <button type="submit" class="btn btn-primary btn-sm">更新</button>
    </div>
  </form>
    
  <div>
            <button type="button" id="edit-tags" class="btn btn-default btn-xs" onclick="$(this).closest(&#39;.labels&#39;).children().toggle()">
      <span class="glyphicon glyphicon-pencil"></span>
      修改标签
    </button>
    <a href="http://www.atatech.org/articles/19071/tags/history" class="btn btn-default btn-xs" data-toggle="modal" data-target="#modal-tag-history">
      <span class="glyphicon glyphicon-time"></span>
      标签历史
    </a>
      </div>
</div>
      </header>
      
      <div class="content unsafe">
        
<h1 id="0">1.内核驱动模块与用户态的交互</h1>
<h2 id="1">1.1    IOKit</h2>
<h3 id="2">1.1.1  IOKit介绍</h3>
<pre><code data-language="" class="java hljs">    IOKit Framework主要是以下两种用途：

    <span class="hljs-number">1.</span>内核端：提供编写内核驱动的所需要的框架和接口。
    <span class="hljs-number">2.</span>用户态端：提供编写和驱动通讯的接口。

   在iOS上IOKit是私有Framework，但是上述两部分都是完整且存在的，考虑到iOS和Mac OSX 内核都是XNU派生出的分支。在编写iOS和驱动通讯的程序时候可以使用参考Mac OSX的头文件，基本不会遇到困难。
</code></pre>
<p>具体iOS IOKit动态库和MACOSX IOKit头文件可以参考以下两个图片：</p>
<p><a href="./iOS 内核驱动分析_files/ee282baedc3b67e0281a3fef32e37e566a20245f" target="_blank"><img src="./iOS 内核驱动分析_files/ee282baedc3b67e0281a3fef32e37e566a20245f" alt="image_1" title="image_1"></a></p>
<p><a href="./iOS 内核驱动分析_files/11cbed7f008ec763f04c81583298cdc67f1881e3" target="_blank"><img src="./iOS 内核驱动分析_files/11cbed7f008ec763f04c81583298cdc67f1881e3" alt="image_2" title="image_2"></a></p>
<pre><code data-language="" class="java hljs">   上文提到的XNU是X IS NOT UNIX的缩写，是苹果公司开发开源内核。当前在苹果官网最新的版本是xnu-<span class="hljs-number">2422.90</span><span class="hljs-number">.20</span>。上文说得IOKit所有源代码都可以能在里面找到。

    XNU地址：
    http:<span class="hljs-comment">//www.opensource.apple.com/source/xnu/</span>
    iOS、Mac OSX发布版本号和XNU版本号的关系：
    http:<span class="hljs-comment">//theiphonewiki.com/wiki/Kernel</span>
</code></pre>
<h3 id="3">1.1.2 与内核驱动通讯的API</h3>
<pre><code data-language="" class="java hljs">    IOConnectCallScalarMethod
</code></pre>
<p><a href="./iOS 内核驱动分析_files/3e99d410609005e4ed622c485e1f9f7a45a8bf8d" target="_blank"><img src="./iOS 内核驱动分析_files/3e99d410609005e4ed622c485e1f9f7a45a8bf8d" alt="image_3" title="image_3"></a></p>
<pre><code data-language="" class="java hljs">    IOConnectCallScalarMethod可以将一个<span class="hljs-number">64</span>位整数类型的变长数组从进程的用户态传到内核对应的驱动模块。
    connection：是已经建立内核驱动链接的句柄，使用者通过调用IOServiceOpen（）可以获取该句柄。
    selector ：是对应驱动派遣函数的索引，由这个参数确定了具体要调用该驱动的哪个接口。
    input ：传到内核的<span class="hljs-number">64</span>位整形数组
    iniputCnt ： 该数组的长度
    output ：用于拷贝内核放回内容的<span class="hljs-number">64</span>位整形数组Buffer
    outputCnt ：既是输入参数也是输出参数；作为输入参数告诉内核可以安全地向output buffer写入多少长度。作为输出参数，在调用结束后会告诉内核实际向output写入的长度。如果用户不需要内核返回任何内容可以传NULL.

    IOConnectCallStructMethod
</code></pre>
<p><a href="./iOS 内核驱动分析_files/c37ecda9e9e386b7f4507fb6ca2b44d6a2f3d9fd" target="_blank"><img src="./iOS 内核驱动分析_files/c37ecda9e9e386b7f4507fb6ca2b44d6a2f3d9fd" alt="image_4" title="image_4"></a></p>
<pre><code data-language="" class="java hljs">    IOConnectCallStructMethod是用于请求具有不同类型的参数的通讯接口。
    inputStruct,inputStructCnt,outputStrcut,outputStructCnt参数含义和上个接口类似，区别是Cnt指定的<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>*的具体数据长度。

    IOConnectCallMethod支持同时传入以上两种参数：
    <span class="hljs-function">kern_return_t
    <span class="hljs-title">IOConnectCallMethod</span><span class="hljs-params">(
    mach_port_t  connection,        // In
    uint32_t     selector,      // In
    <span class="hljs-keyword">const</span> uint64_t  *input,         // In
    uint32_t     inputCnt,      // In
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span>      *inputStruct,       // In
    size_t       inputStructCnt,    // In
    uint64_t    *output,        // Out
    uint32_t    *outputCnt,     // In/Out
    <span class="hljs-keyword">void</span>        *outputStruct,      // Out
    size_t      *outputStructCnt)</span>   <span class="hljs-comment">// In/Out</span>
</span></code></pre>
<h2 id="4">1.2    从一个内核驱动漏洞开始</h2>
<pre><code data-language="" class="java hljs">   代码执行的环境是iPhone4 iOS6<span class="hljs-number">.1</span><span class="hljs-number">.2</span> 固件版本号是<span class="hljs-number">10</span>B146：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/bcd3dce20c2f34b0661d962d0cec20aa25cedb37" target="_blank"><img src="./iOS 内核驱动分析_files/bcd3dce20c2f34b0661d962d0cec20aa25cedb37" alt="image_5" title="image_5"></a></p>
<pre><code data-language="" class="java hljs">   代码执行完后，手机重启了，以下是Kernel Panic Log：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/98b249c11d73429a6d5e81da313a75d9dd727bf8" target="_blank"><img src="./iOS 内核驱动分析_files/98b249c11d73429a6d5e81da313a75d9dd727bf8" alt="image_6" title="image_6"></a></p>
<pre><code data-language="" class="java hljs">   由于主题及篇幅限制，这里只是完成了内核拒绝访问的利用。
   由上面Panic Log看到r0是我们传进去的值，对应是c++的对象参数（<span class="hljs-keyword">this</span>）。
   关注iOS安全圈的朋友会知道，这个其实是完成iOS6完美越狱的代码执行漏洞。对应的是IOUSBDeviceFamliy的Selector <span class="hljs-number">15</span>会接受一个对象，然后去调用这个对象成员变量的vtable函数，但是只是对传入对象做了弱校验（对象某个成员变量是否为<span class="hljs-number">1</span>），这使得我们有可以利用的空间。
   出于严谨的态度，上面的demo也不是一定能造成内核Panic，因为内核毕竟还是做了一个比较弱的校验，要提高拒绝服务的成功率，我们应该这样写（^<span class="hljs-number">_</span>^）：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/4904b54b785ca72b9d1f85ce35826c16560338b8" target="_blank"><img src="./iOS 内核驱动分析_files/4904b54b785ca72b9d1f85ce35826c16560338b8" alt="image_7" title="image_7"></a></p>
<h2 id="5">1.3接下来讨论</h2>
<pre><code data-language="" class="java hljs">   怎样定位该函数调用时在内核的执行流？
   有没有可能通过自动化的方式找到类似的代码执行漏洞？
</code></pre>
<h1 id="6">2.内核Cache获取</h1>
<h2 id="7">2.1静态内核Cache提取原理</h2>
<pre><code data-language="" class="java hljs">    iOS固件的文件格式是IPSW；安装的时候在手机端用iboot秘钥动态解密后再安装。因此如果没有手机的秘钥是无法静态地从IPSW文件中获取有有效的内核cache文件。由于A4设备存在硬件漏洞，使得可以把手机的秘钥动态的Dump出来。
   下图是iPhone4已经公开Key的列表：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/51ded7307486431f4092c51aabcb466cd41b43b6" target="_blank"><img src="./iOS 内核驱动分析_files/51ded7307486431f4092c51aabcb466cd41b43b6" alt="image_8" title="image_8"></a></p>
<pre><code data-language="" class="java hljs">    从iOS8开始iPhone4不再支持，如果无法通过其他设备的底层漏洞获取获取其秘钥的话，将无法静态分析iOS的二进制文件。这使得iOS8的首个越狱开发门槛进一步提高。
</code></pre>
<h2 id="8">2.2具体操作会用到的工具</h2>
<pre><code data-language="" class="java hljs">    kcache
    https:<span class="hljs-comment">//github.com/badeip/kcache/blob/master/README</span>
    kernelcache.release.n90文件可以直接用IPSW改后缀ZIP，解压缩直接得到。
</code></pre>
<h1 id="9">3.内核反编译分析</h1>
<h2 id="10">3.1内核Mach-O Over View</h2>
<pre><code data-language="" class="java hljs">   上面说的kernelcache.release.n90文件以Mach-O格式为单位Layout如下图：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/f1941328b272750a18047e3810da70ac94b1adcf" target="_blank"><img src="./iOS 内核驱动分析_files/f1941328b272750a18047e3810da70ac94b1adcf" alt="image_9" title="image_9"></a></p>
<pre><code data-language="" class="java hljs">   在内核Mach-O的Data段可以找到IOKit组件类的vtable符号：
    etc：IOUserClient
</code></pre>
<p><a href="./iOS 内核驱动分析_files/45c1d07651f2aaae82bed87f9d14568097fcebaf" target="_blank"><img src="./iOS 内核驱动分析_files/45c1d07651f2aaae82bed87f9d14568097fcebaf" alt="image_10" title="image_10"></a></p>
<h2 id="11">3.2内核驱动派遣函数定位原理</h2>
<pre><code data-language="" class="java hljs">   每个驱动程序包最多只有<span class="hljs-number">1</span>个IOUserClient的子类实现对用户提供服务。回想起前面Demo调用的IOConnectCallStructMethod函数，在内核端其实就是各个驱动模块的IOUserClient子类负责具体函数的dispatch，传进来的selector是索引，因此IOUserClient必定会有对应的派遣逻辑：

    IOUserClient关键的派遣函数：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/b9ac934607a9a3093843796d12224a7e94aeda2e" target="_blank"><img src="./iOS 内核驱动分析_files/b9ac934607a9a3093843796d12224a7e94aeda2e" alt="image_11" title="image_11"></a></p>
<pre><code data-language="" class="java hljs">   通过IOConnectCallStructMethod等函数发起内核调用该函数时候，传入的selector和arguments有值，其他都NULL。IOUserClient实现externalMethod关键逻辑如下(XNU源代码)：

   当dispatch非空的时候，会直接根据参数发起调用，下面是xnu源码片段：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/4d2ec68a165ea8e6d8a4595c9cc99748fa6bb541" target="_blank"><img src="./iOS 内核驱动分析_files/4d2ec68a165ea8e6d8a4595c9cc99748fa6bb541" alt="image_12" title="image_12"></a></p>
<pre><code data-language="" class="java hljs">   当dispatch为空时会跑以下逻辑：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/9f5f4e8f5e6c136da447c3781126bc6623668483" target="_blank"><img src="./iOS 内核驱动分析_files/9f5f4e8f5e6c136da447c3781126bc6623668483" alt="image_13" title="image_13"></a></p>
<pre><code data-language="" class="java hljs">   通过getTargetAndMethodForIndex函数获取需要执行的函数指针，getTargetAndMethodForIndex实现如下：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/e965a0bc75f52012a3f2dc3f9dc34d91fa229980" target="_blank"><img src="./iOS 内核驱动分析_files/e965a0bc75f52012a3f2dc3f9dc34d91fa229980" alt="image_15" title="image_15"></a></p>
<p><a href="./iOS 内核驱动分析_files/f7d45234aadea1dcafc409e318724abcaef28610" target="_blank"><img src="./iOS 内核驱动分析_files/f7d45234aadea1dcafc409e318724abcaef28610" alt="image_14" title="image_14"></a></p>
<pre><code data-language="" class="java hljs">   由上清晰可知，IOKit希望驱动编写者要么重载externalMethod函数传入非空的dispatch，要么重载getExternalMethodForIndex返回有效的执行函数。这样才能正确响应用户调用的IOConnectCallStructMethod等函数。

   因此定位驱动对应Selector执行逻辑是： 
    C++ vtable表的顺序是：父*n-&gt;父*(n-<span class="hljs-number">1</span>) -&gt;父*(n-<span class="hljs-number">2</span>)…父-&gt;子
   因此只要找到对应Mach-O驱动IOUseClient子类的vtable。根据IOUseClient的vtable表推断该子类是重载了externalMethod或getExternalMethodForIndex。
</code></pre>
<h2 id="12">3.3IOUSBDeviceFamily派遣函数分析</h2>
<pre><code data-language="" class="java hljs">   本节相当于是<span class="hljs-number">3.2</span>定位原理的实践。
   回想起本文第一节的DEMO，调用的驱动便是IOUSBDeviceFamily，接下来会解析Demo的调用在内核层面代码是怎样执行的。首先我们要确定它是通过externalMethod还是getExternalMethodForIndex来实现selector的派遣。

    IOUSBDeviceFamily的IOUserClient子类vtable片段如下：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/a3c40f9a19f1a6c965fa8768cb7064167b9764b3" target="_blank"><img src="./iOS 内核驱动分析_files/a3c40f9a19f1a6c965fa8768cb7064167b9764b3" alt="image_16" title="image_16"></a></p>
<p><a href="./iOS 内核驱动分析_files/46371dce1915785f7bc16ad9023fac84bf0bbd44" target="_blank"><img src="./iOS 内核驱动分析_files/46371dce1915785f7bc16ad9023fac84bf0bbd44" alt="image_17" title="image_17"></a></p>
<pre><code data-language="" class="java hljs">    IOUserClient的vtable片段如下：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/70a128c2ad5bd27f6f3f4a559efde6eec7340d10" target="_blank"><img src="./iOS 内核驱动分析_files/70a128c2ad5bd27f6f3f4a559efde6eec7340d10" alt="image_18" title="image_18"></a></p>
<pre><code data-language="" class="java hljs">   由上片段可知，IOUSBDeviceFamily的IOUserClient子类是重载了externalMethod函数且没有对getExternalMethodForIndex进行重载。
   地址sub_80661610是对externalMethod的重载，下图是sub_80661610的具体实现：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/d871cc85bd1cc51f1a2d2db7d62c713babf7fcb5" target="_blank"><img src="./iOS 内核驱动分析_files/d871cc85bd1cc51f1a2d2db7d62c713babf7fcb5" alt="image_19" title="image_19"></a></p>
<pre><code data-language="" class="java hljs">     函数的参数定义如下：
     ( uint32_t selector, IOExternalMethodArguments * arguments,IOExternalMethodDispatch * dispatch = <span class="hljs-number">0</span>, OSObject * target = <span class="hljs-number">0</span>, <span class="hljs-keyword">void</span> * reference = <span class="hljs-number">0</span>)
     所以在调用PUSH{R5,R7,LR}前寄存器的状态如下：r0:<span class="hljs-keyword">this</span>(IOUserClient SubClass);r1:selector;r2:arguments;r3:dispatch;sp:target;sp+<span class="hljs-number">4</span>:reference

    off_806670FC是IOUserClient vtable的Import Symbol，(*off_806670FC+<span class="hljs-number">0x340</span>)等于IOUserClient::externalMethod的地址，loc_80661634实际上等价于<span class="hljs-keyword">super</span>::externalMethod（IOUserClient::externalMethod）的调用。

   我们关心的是传到基类的dispatch何target参数如何生成，由上述汇编推导出生成规则如下：
    target = r0(IOUserClient SubClass)
    dispatch = off_806679F0 + (selector + selector&lt;&lt;<span class="hljs-number">2</span>)&lt;&lt;<span class="hljs-number">2</span>
    dispatch = off_806679F0 + <span class="hljs-number">20</span> * selector
   容易得出结论，selector对应的派遣函数表保存在偏移量在<span class="hljs-number">806670F</span>C的地址。且每个dispatch对象的长度是<span class="hljs-number">20</span>字节。
</code></pre>
<h2 id="13">3.4派遣函数表</h2>
<p>IOExternalMethodDispatch对象在IOKit中定义如下：</p>
<pre><code data-language="" class="java hljs">     <span class="hljs-function">typedef <span class="hljs-title">IOReturn</span> <span class="hljs-params">(*IOExternalMethodAction)</span><span class="hljs-params">(OSObject * target, <span class="hljs-keyword">void</span> * reference, IOExternalMethodArguments * arguments)</span>

     struct IOExternalMethodDispatch
    </span>{
        IOExternalMethodAction * function;
        uint32_t           checkScalarInputCount;
        uint32_t           checkStructureInputSize;
        uint32_t           checkScalarOutputCount;
        uint32_t           checkStructureOutputSize;
    };  

     IOExternalMethodDispatch长度和我们上面推断的生成长度一致，字段含义如下：
     function：selector对应的实际函数指针
     checkScalarInputCount：int64传入数组长度要求
     checkStructureInputSize：Struct传入长度要求
     checkScalarOutputCount：int64传出结果长度
     checkStructureOutputSize：Struct传出结果长度

    上文IOUSBDeviceFamily对应的selecor <span class="hljs-number">15</span>对应的地址如下：
     dispatch = off_806679F0 + <span class="hljs-number">20</span> * selector
     dispatch = off_806679F0 + <span class="hljs-number">20</span> * <span class="hljs-number">15</span>
     dispatch = off_80667B1C
     off_80667B1C 地址如下图：
</code></pre>
<p><a href="./iOS 内核驱动分析_files/da6e6bf47ad1a3383280cc4ee3dfa94cd8f89c13" target="_blank"><img src="./iOS 内核驱动分析_files/da6e6bf47ad1a3383280cc4ee3dfa94cd8f89c13" alt="image_20" title="image_20"></a></p>
<pre><code data-language="" class="java hljs">     因此各个字段的值如下：
      function：<span class="hljs-number">80661E4</span>B对应的Text地址
      checkScalarInputCount：<span class="hljs-number">1</span>
      checkStructureInputSize：<span class="hljs-number">0</span>
      checkScalarOutputCount：<span class="hljs-number">0</span>
      checkStructureOutputSize：<span class="hljs-number">0</span>
     恰好是与我们Demo输入的参数长度一致!

     其实只要自己往下分析<span class="hljs-number">80661E4</span>B地址对应的具体实现就能搞明白我们的Demo是怎样造成内核Panic，抑或还是否能有其他利用的方式，但是这些不在本文的讨论范围。有兴趣可以继续深挖的朋友，遇到困惑可以直接联系我。
</code></pre>
<h1 id="14">4.驱动Fuzzing准备</h1>
<pre><code data-language="" class="java hljs">     上面所讲的所有内容都是为驱动Fuzzing做理论准备。完成有效的iOS驱动Fuzzing要至少要做到以下几点：
      <span class="hljs-number">1.</span>能覆盖手机上得所有驱动。
      <span class="hljs-number">2.</span>能获知每个驱动对应的selector count
      <span class="hljs-number">3.</span>能获知驱动对应的每个selector对应的输入输出长度及类型。

     只要在满足以上三点的前提下，输入的Fuzzing才能到达具体的实际的逻辑处理函数。

     在研究其他驱动模块可知，其逻辑和上文所介绍基本一致。因此只要基于IDAPython匹配对应的汇编特征，是可以直接用内核Cache dump出我们所需要的以上三点信息！
     基于IDAPython生成出来的信息再自动化定制我们的Fuzzing参数时能具有更高的可达性。
</code></pre>
<h1 id="15">4.最后</h1>
<pre><code data-language="" class="java hljs">匆忙地将文章写完，可能会有处理不当地方，请读者见谅。Anyway，希望文章对大家理解iOS内核驱动模块有所帮助；同时我也希望通过找到更多对系统安全感兴趣的朋友。
</code></pre>

      </div>
            
      
      <div class="_article-float hidden-xs" data-fixed="false">
        <div class="container">
          <div class="_article-float-inner">
          <aside class="_article-side">
    <a href="http://www.atatech.org/articles/19071/follow" class="btn btn-primary btn-block" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).parent().replaceWith(r)">关注</a>
    <section class="_article-followers">
    <h6 class="heading text-center">11人关注该文章</h6>
    <ul class="list-inline">
      <li><a href="http://www.atatech.org/users/72639" title="士恒"><img src="./iOS 内核驱动分析_files/u_identicon_98b9b1c82f99a4dbd10268497a56f4fd.png_80x80" width="26" height="26" alt="士恒" class="img-user"></a></li><li><a href="http://www.atatech.org/users/72203" title="风叶"><img src="./iOS 内核驱动分析_files/72203_20140506184812_58.jpg_80x80" width="26" height="26" alt="风叶" class="img-user"></a></li><li><a href="http://www.atatech.org/users/21141" title="西夜"><img src="./iOS 内核驱动分析_files/img_20141009173806.jpg_80x80" width="26" height="26" alt="西夜" class="img-user"></a></li><li><a href="http://www.atatech.org/users/79564" title="耀刺"><img src="./iOS 内核驱动分析_files/u_identicon_976f26e16f52c34681b9c02a07a99974.png_80x80" width="26" height="26" alt="耀刺" class="img-user"></a></li><li><a href="http://www.atatech.org/users/19178" title="翔龙"><img src="./iOS 内核驱动分析_files/u_avatar_20120719180929_19178_60.jpeg_80x80" width="26" height="26" alt="翔龙" class="img-user"></a></li><li><a href="http://www.atatech.org/users/68639" title="儁乂"><img src="./iOS 内核驱动分析_files/u_identicon_2f970eaa3ff6eb9cae9fe81fb500706c.png_80x80" width="26" height="26" alt="儁乂" class="img-user"></a></li><li><a href="http://www.atatech.org/users/78045" title="若泓"><img src="./iOS 内核驱动分析_files/u_identicon_7624f698e3b30cd4176cd631e9ebb647.png_80x80" width="26" height="26" alt="若泓" class="img-user"></a></li><li><a href="http://www.atatech.org/users/33401" title="风鸣"><img src="./iOS 内核驱动分析_files/u_identicon_eea8374d4f01af690cc2879d01ae78d4.png_80x80" width="26" height="26" alt="风鸣" class="img-user"></a></li><li><a data-toggle="modal" href="http://www.atatech.org/articles/19071/followers" data-target="#modal-followers" title="查看全部"><div class="img-user img-user-more text-center" style="width:26px;height:26px">...</div></a></li>    </ul>
  </section>
</aside>
          </div>
        </div>
      </div>

      <footer class="actions">
        <a href="http://www.atatech.org/articles/19071?rnd=598849306#comment" class="btn btn-primary js-scroll-to">评论文章
                      (7)
                  </a>
        <a href="http://www.atatech.org/articles/19071/voteup" title="赞" class="btn btn-default" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).next().addBack().toggle();$(&#39;#voters&#39;).html(r)">
          <span class="glyphicon glyphicon-thumbs-up"></span>
          11
        </a>
        <a href="http://www.atatech.org/articles/19071/unvoteup" title="取消赞" class="btn btn-primary" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).prev().addBack().toggle();$(&#39;#voters&#39;).html(r)" style="display:none">
          <span class="glyphicon glyphicon-thumbs-up"></span>
          12
        </a>
                <button class="btn btn-default" data-toggle="modal" data-target="#modal-share" data-article-id="19071" data-share-count-target="#share-count" title="分享">
          <span class="glyphicon glyphicon-share"></span>
          <span id="share-count">0</span>
        </button>
                	<!-- 收藏 -->
        <a href="http://www.atatech.org/articles/19071/mark" title="收藏" class="btn btn-default" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).next().addBack().toggle()">
          <span class="glyphicon glyphicon-star"></span>
          3
        </a>
        <a href="http://www.atatech.org/articles/19071/unmark" title="取消收藏" class="btn btn-primary" role="button" rel="nofollow" data-remote="true" data-done="$(this).prev().addBack().toggle()" data-method="post" style="display:none">
          <span class="glyphicon glyphicon-star"></span>
          4
        </a>
      </footer>
    </article>

    <hr>
    

    <div id="voters">
      <div id="voters" class="_article-voters">
  <h3 class="heading">他们赞过该文章</h3>
  <ul class="list-inline"><li><a href="http://www.atatech.org/users/78099" title="文俶"><img src="./iOS 内核驱动分析_files/u_identicon_42b84a422cab4c8e63931940189dd41c.png_80x80" width="28" height="28" alt="文俶" class="img-user"></a></li><li><a href="http://www.atatech.org/users/20568" title="腾逸"><img src="./iOS 内核驱动分析_files/u_identicon_338c070809f38739e58e2a12a2684633.png_80x80" width="28" height="28" alt="腾逸" class="img-user"></a></li><li><a href="http://www.atatech.org/users/72203" title="风叶"><img src="./iOS 内核驱动分析_files/72203_20140506184812_58.jpg_80x80" width="28" height="28" alt="风叶" class="img-user"></a></li><li><a href="http://www.atatech.org/users/79483" title="意尘"><img src="./iOS 内核驱动分析_files/u_identicon_800eff904083b14c4afebef919659c63.png_80x80" width="28" height="28" alt="意尘" class="img-user"></a></li><li><a href="http://www.atatech.org/users/78045" title="若泓"><img src="./iOS 内核驱动分析_files/u_identicon_7624f698e3b30cd4176cd631e9ebb647.png_80x80" width="28" height="28" alt="若泓" class="img-user"></a></li><li><a href="http://www.atatech.org/users/77500" title="典扬"><img src="./iOS 内核驱动分析_files/img_20140720192024.jpg_80x80" width="28" height="28" alt="典扬" class="img-user"></a></li><li><a href="http://www.atatech.org/users/71139" title="行中"><img src="./iOS 内核驱动分析_files/u_identicon_e3e2eb3bd8012c39f7d9648fcc402734.png_80x80" width="28" height="28" alt="行中" class="img-user"></a></li><li><a href="http://www.atatech.org/users/19863" title="夜莺"><img src="./iOS 内核驱动分析_files/img_20150317142225.jpg_80x80" width="28" height="28" alt="夜莺" class="img-user"></a></li><li><a href="http://www.atatech.org/users/79564" title="耀刺"><img src="./iOS 内核驱动分析_files/u_identicon_976f26e16f52c34681b9c02a07a99974.png_80x80" width="28" height="28" alt="耀刺" class="img-user"></a></li><li><a href="http://www.atatech.org/users/33401" title="风鸣"><img src="./iOS 内核驱动分析_files/u_identicon_eea8374d4f01af690cc2879d01ae78d4.png_80x80" width="28" height="28" alt="风鸣" class="img-user"></a></li><li><a href="http://www.atatech.org/users/79390" title="土侸"><img src="./iOS 内核驱动分析_files/u_identicon_f974b2594f093935ab0946f1587437b6.png_80x80" width="28" height="28" alt="土侸" class="img-user"></a></li><!-- <li><a href="#" class="img-user _article-voters-more" style="width:28px;height:28px">...</a></li> --></ul></div>
<hr>
    </div>

            <table width="100%" class="cnzz-event" id="article-recommend">
            <tbody><tr>
                <th rowspan="3" width="5%">相<br>似<br>文<br>章</th>
                <td width="50%"><li><a href="http://www.atatech.org/articles/22034">MongoDB源码分析之存储文件格式</a></li></td>
                <td width="45%"><li><a href="http://www.atatech.org/articles/27311">64位适配注意事项</a></li></td>
            </tr>
                            <tr>
                    <td><li><a href="http://www.atatech.org/articles/30404">c++多线程编程</a></li></td>
                    <td><li><a href="http://www.atatech.org/articles/16013">Android系统性能调优工具介绍（转）</a></li></td>
                </tr>
                            <tr>
                    <td><li><a href="http://www.atatech.org/articles/2513">修炼内功：TCP／IP协议栈初探 （2）</a></li></td>
                    <td><li><a href="http://www.atatech.org/articles/22860">iOS Crash 分析（文二）-崩溃日志组成</a></li></td>
                </tr>
                    </tbody></table>
    
        <ul class="pager _article-pager">
                  <li class="next"><a href="http://www.atatech.org/articles/23673">下一篇：提交苹果的内核漏洞-CVE-2014-4369分析报告</a></li>
          </ul>
    <hr>
    
    <section class="comments-box clearfix">
      <div class="media-list comments" id="comments">
        
<div class="comment media gaze in" id="comment-23760">
  <div class="pull-left">
    <a href="http://www.atatech.org/users/33401" class="avatar">
      <img class="media-object img-circle" src="./iOS 内核驱动分析_files/u_identicon_eea8374d4f01af690cc2879d01ae78d4.png_120x120" width="42" height="42" alt="">
    </a>
        <span style="margin-left: 10px">
        1F
    </span>
      </div>
  <div class="media-body">
    <div class="source clearfix">
      <a href="http://www.atatech.org/users/33401" class="author">风鸣</a>
            <span class="pull-right small">
        <a href="http://www.atatech.org/articles/19071?rnd=598849306#comment-23760" class="link"><span class="glyphicon glyphicon-link"></span></a>
        <time class="js-relative-time" datetime="2014-07-11T14:29:15+08:00">2014-07-11 14:29:15</time>
      </span>
    </div>

    <div class="content unsafe">
      
<p>赞！可以再详细介绍介绍fuzzing呗：）</p>

    </div>
    
    <div class="voters-p"></div>

    <div class="actions clearfix">
      <a href="http://www.atatech.org/comments/23760/voteup" title="赞" class="btn btn-link btn-sm action" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        0
      </a>
      <a href="http://www.atatech.org/comments/23760/unvoteup" title="取消赞" class="btn btn-link btn-sm action active" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()" style="display:none">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        1
      </a>
      <span class="sep"></span>
      <button class="btn btn-link btn-sm action" onclick="$(&#39;#sub-comments-box-23760&#39;).toggle()">
        <span class="glyphicon glyphicon-comment"></span> 
        <span id="sub-comments-count-23760">0</span>
      </button>
      
          </div><!-- /.media-body -->
    
    <div class="sub-comments-box" id="sub-comments-box-23760" style="display:none">
      <div class="sub-comments media-list" id="comment-23760-sub">


  

</div>


<form action="http://www.atatech.org/comments/23760/subcomments/" method="POST" data-remote="true" data-target="#comment-23760-sub" data-done="$(&#39;#sub-comments-count-23760&#39;).inc()" class="sub-comment-form js-comment-create js-active-on-valid">
  <input type="hidden" name="isCheck" value="1">
    <div class="form-group">
    <textarea name="content" rows="1" class="form-control js-mention js-auto-expand" placeholder="写下你的评论…" onfocus="$(this).closest(&#39;form&#39;).addClass(&#39;active&#39;)" required=""></textarea>
  </div>
  <div class="form-group text-right actions">
    <button type="reset" class="btn btn-default btn-sm" onclick="$(this).closest(&#39;form&#39;).removeClass(&#39;active&#39;)">取消</button>
    <button type="submit" class="btn btn-primary btn-sm" disabled="">评论</button>
  </div>
</form>
    </div><!-- /.sub-comments-box -->
  </div>
  
  </div>
<div class="comment media gaze in" id="comment-23761">
  <div class="pull-left">
    <a href="http://www.atatech.org/users/71139" class="avatar">
      <img class="media-object img-circle" src="./iOS 内核驱动分析_files/u_identicon_e3e2eb3bd8012c39f7d9648fcc402734.png_120x120" width="42" height="42" alt="">
    </a>
        <span style="margin-left: 10px">
        2F
    </span>
      </div>
  <div class="media-body">
    <div class="source clearfix">
      <a href="http://www.atatech.org/users/71139" class="author">行中</a>
            <span class="pull-right small">
        <a href="http://www.atatech.org/articles/19071?rnd=598849306#comment-23761" class="link"><span class="glyphicon glyphicon-link"></span></a>
        <time class="js-relative-time" datetime="2014-07-11T14:30:03+08:00">2014-07-11 14:30:03</time>
      </span>
    </div>

    <div class="content unsafe">
      
<p>难得看到iOS方面这么深入的，多来点啊</p>

    </div>
    
    <div class="voters-p"></div>

    <div class="actions clearfix">
      <a href="http://www.atatech.org/comments/23761/voteup" title="赞" class="btn btn-link btn-sm action" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        0
      </a>
      <a href="http://www.atatech.org/comments/23761/unvoteup" title="取消赞" class="btn btn-link btn-sm action active" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()" style="display:none">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        1
      </a>
      <span class="sep"></span>
      <button class="btn btn-link btn-sm action" onclick="$(&#39;#sub-comments-box-23761&#39;).toggle()">
        <span class="glyphicon glyphicon-comment"></span> 
        <span id="sub-comments-count-23761">0</span>
      </button>
      
          </div><!-- /.media-body -->
    
    <div class="sub-comments-box" id="sub-comments-box-23761" style="display:none">
      <div class="sub-comments media-list" id="comment-23761-sub">


  

</div>


<form action="http://www.atatech.org/comments/23761/subcomments/" method="POST" data-remote="true" data-target="#comment-23761-sub" data-done="$(&#39;#sub-comments-count-23761&#39;).inc()" class="sub-comment-form js-comment-create js-active-on-valid">
  <input type="hidden" name="isCheck" value="1">
    <div class="form-group">
    <textarea name="content" rows="1" class="form-control js-mention js-auto-expand" placeholder="写下你的评论…" onfocus="$(this).closest(&#39;form&#39;).addClass(&#39;active&#39;)" required=""></textarea>
  </div>
  <div class="form-group text-right actions">
    <button type="reset" class="btn btn-default btn-sm" onclick="$(this).closest(&#39;form&#39;).removeClass(&#39;active&#39;)">取消</button>
    <button type="submit" class="btn btn-primary btn-sm" disabled="">评论</button>
  </div>
</form>
    </div><!-- /.sub-comments-box -->
  </div>
  
  </div>
<div class="comment media gaze in" id="comment-23762">
  <div class="pull-left">
    <a href="http://www.atatech.org/users/19863" class="avatar">
      <img class="media-object img-circle" src="./iOS 内核驱动分析_files/img_20150317142225.jpg_120x120" width="42" height="42" alt="">
    </a>
        <span style="margin-left: 10px">
        3F
    </span>
      </div>
  <div class="media-body">
    <div class="source clearfix">
      <a href="http://www.atatech.org/users/19863" class="author">夜莺</a>
            <span class="pull-right small">
        <a href="http://www.atatech.org/articles/19071?rnd=598849306#comment-23762" class="link"><span class="glyphicon glyphicon-link"></span></a>
        <time class="js-relative-time" datetime="2014-07-11T14:30:26+08:00">2014-07-11 14:30:26</time>
      </span>
    </div>

    <div class="content unsafe">
      
<p>非常给力，醍醐灌顶啊。</p>

    </div>
    
    <div class="voters-p"></div>

    <div class="actions clearfix">
      <a href="http://www.atatech.org/comments/23762/voteup" title="赞" class="btn btn-link btn-sm action" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        0
      </a>
      <a href="http://www.atatech.org/comments/23762/unvoteup" title="取消赞" class="btn btn-link btn-sm action active" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()" style="display:none">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        1
      </a>
      <span class="sep"></span>
      <button class="btn btn-link btn-sm action" onclick="$(&#39;#sub-comments-box-23762&#39;).toggle()">
        <span class="glyphicon glyphicon-comment"></span> 
        <span id="sub-comments-count-23762">0</span>
      </button>
      
          </div><!-- /.media-body -->
    
    <div class="sub-comments-box" id="sub-comments-box-23762" style="display:none">
      <div class="sub-comments media-list" id="comment-23762-sub">


  

</div>


<form action="http://www.atatech.org/comments/23762/subcomments/" method="POST" data-remote="true" data-target="#comment-23762-sub" data-done="$(&#39;#sub-comments-count-23762&#39;).inc()" class="sub-comment-form js-comment-create js-active-on-valid">
  <input type="hidden" name="isCheck" value="1">
    <div class="form-group">
    <textarea name="content" rows="1" class="form-control js-mention js-auto-expand" placeholder="写下你的评论…" onfocus="$(this).closest(&#39;form&#39;).addClass(&#39;active&#39;)" required=""></textarea>
  </div>
  <div class="form-group text-right actions">
    <button type="reset" class="btn btn-default btn-sm" onclick="$(this).closest(&#39;form&#39;).removeClass(&#39;active&#39;)">取消</button>
    <button type="submit" class="btn btn-primary btn-sm" disabled="">评论</button>
  </div>
</form>
    </div><!-- /.sub-comments-box -->
  </div>
  
  </div>
<div class="comment media gaze in" id="comment-23763">
  <div class="pull-left">
    <a href="http://www.atatech.org/users/77500" class="avatar">
      <img class="media-object img-circle" src="./iOS 内核驱动分析_files/img_20140720192024.jpg_120x120" width="42" height="42" alt="">
    </a>
        <span style="margin-left: 10px">
        4F
    </span>
      </div>
  <div class="media-body">
    <div class="source clearfix">
      <a href="http://www.atatech.org/users/77500" class="author">典扬</a>
            <span class="pull-right small">
        <a href="http://www.atatech.org/articles/19071?rnd=598849306#comment-23763" class="link"><span class="glyphicon glyphicon-link"></span></a>
        <time class="js-relative-time" datetime="2014-07-11T14:32:31+08:00">2014-07-11 14:32:31</time>
      </span>
    </div>

    <div class="content unsafe">
      
<p>赞！一直想学习一下iOS的驱动，这下省事了。</p>

    </div>
    
    <div class="voters-p"></div>

    <div class="actions clearfix">
      <a href="http://www.atatech.org/comments/23763/voteup" title="赞" class="btn btn-link btn-sm action" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        0
      </a>
      <a href="http://www.atatech.org/comments/23763/unvoteup" title="取消赞" class="btn btn-link btn-sm action active" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()" style="display:none">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        1
      </a>
      <span class="sep"></span>
      <button class="btn btn-link btn-sm action" onclick="$(&#39;#sub-comments-box-23763&#39;).toggle()">
        <span class="glyphicon glyphicon-comment"></span> 
        <span id="sub-comments-count-23763">0</span>
      </button>
      
          </div><!-- /.media-body -->
    
    <div class="sub-comments-box" id="sub-comments-box-23763" style="display:none">
      <div class="sub-comments media-list" id="comment-23763-sub">


  

</div>


<form action="http://www.atatech.org/comments/23763/subcomments/" method="POST" data-remote="true" data-target="#comment-23763-sub" data-done="$(&#39;#sub-comments-count-23763&#39;).inc()" class="sub-comment-form js-comment-create js-active-on-valid">
  <input type="hidden" name="isCheck" value="1">
    <div class="form-group">
    <textarea name="content" rows="1" class="form-control js-mention js-auto-expand" placeholder="写下你的评论…" onfocus="$(this).closest(&#39;form&#39;).addClass(&#39;active&#39;)" required=""></textarea>
  </div>
  <div class="form-group text-right actions">
    <button type="reset" class="btn btn-default btn-sm" onclick="$(this).closest(&#39;form&#39;).removeClass(&#39;active&#39;)">取消</button>
    <button type="submit" class="btn btn-primary btn-sm" disabled="">评论</button>
  </div>
</form>
    </div><!-- /.sub-comments-box -->
  </div>
  
  </div>
<div class="comment media gaze in" id="comment-23765">
  <div class="pull-left">
    <a href="http://www.atatech.org/users/19178" class="avatar">
      <img class="media-object img-circle" src="./iOS 内核驱动分析_files/u_avatar_20120719180929_19178_60.jpeg_120x120" width="42" height="42" alt="">
    </a>
        <span style="margin-left: 10px">
        5F
    </span>
      </div>
  <div class="media-body">
    <div class="source clearfix">
      <a href="http://www.atatech.org/users/19178" class="author">翔龙</a>
            <span class="pull-right small">
        <a href="http://www.atatech.org/articles/19071?rnd=598849306#comment-23765" class="link"><span class="glyphicon glyphicon-link"></span></a>
        <time class="js-relative-time" datetime="2014-07-11T14:47:39+08:00">2014-07-11 14:47:39</time>
      </span>
    </div>

    <div class="content unsafe">
      
<p>很给力，是干货啊</p>

    </div>
    
    <div class="voters-p"></div>

    <div class="actions clearfix">
      <a href="http://www.atatech.org/comments/23765/voteup" title="赞" class="btn btn-link btn-sm action" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        0
      </a>
      <a href="http://www.atatech.org/comments/23765/unvoteup" title="取消赞" class="btn btn-link btn-sm action active" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()" style="display:none">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        1
      </a>
      <span class="sep"></span>
      <button class="btn btn-link btn-sm action" onclick="$(&#39;#sub-comments-box-23765&#39;).toggle()">
        <span class="glyphicon glyphicon-comment"></span> 
        <span id="sub-comments-count-23765">0</span>
      </button>
      
          </div><!-- /.media-body -->
    
    <div class="sub-comments-box" id="sub-comments-box-23765" style="display:none">
      <div class="sub-comments media-list" id="comment-23765-sub">


  

</div>


<form action="http://www.atatech.org/comments/23765/subcomments/" method="POST" data-remote="true" data-target="#comment-23765-sub" data-done="$(&#39;#sub-comments-count-23765&#39;).inc()" class="sub-comment-form js-comment-create js-active-on-valid">
  <input type="hidden" name="isCheck" value="1">
    <div class="form-group">
    <textarea name="content" rows="1" class="form-control js-mention js-auto-expand" placeholder="写下你的评论…" onfocus="$(this).closest(&#39;form&#39;).addClass(&#39;active&#39;)" required=""></textarea>
  </div>
  <div class="form-group text-right actions">
    <button type="reset" class="btn btn-default btn-sm" onclick="$(this).closest(&#39;form&#39;).removeClass(&#39;active&#39;)">取消</button>
    <button type="submit" class="btn btn-primary btn-sm" disabled="">评论</button>
  </div>
</form>
    </div><!-- /.sub-comments-box -->
  </div>
  
  </div>
<div class="comment media gaze in" id="comment-23766">
  <div class="pull-left">
    <a href="http://www.atatech.org/users/66087" class="avatar">
      <img class="media-object img-circle" src="./iOS 内核驱动分析_files/u_identicon_497a029d45e44c8f9cfb18713bc133b4.png_120x120" width="42" height="42" alt="">
    </a>
        <span style="margin-left: 10px">
        6F
    </span>
      </div>
  <div class="media-body">
    <div class="source clearfix">
      <a href="http://www.atatech.org/users/66087" class="author">独归</a>
            <span class="pull-right small">
        <a href="http://www.atatech.org/articles/19071?rnd=598849306#comment-23766" class="link"><span class="glyphicon glyphicon-link"></span></a>
        <time class="js-relative-time" datetime="2014-07-11T14:53:42+08:00">2014-07-11 14:53:42</time>
      </span>
    </div>

    <div class="content unsafe">
      
<p>写的很好呀</p>

    </div>
    
    <div class="voters-p"></div>

    <div class="actions clearfix">
      <a href="http://www.atatech.org/comments/23766/voteup" title="赞" class="btn btn-link btn-sm action" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        0
      </a>
      <a href="http://www.atatech.org/comments/23766/unvoteup" title="取消赞" class="btn btn-link btn-sm action active" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()" style="display:none">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        1
      </a>
      <span class="sep"></span>
      <button class="btn btn-link btn-sm action" onclick="$(&#39;#sub-comments-box-23766&#39;).toggle()">
        <span class="glyphicon glyphicon-comment"></span> 
        <span id="sub-comments-count-23766">0</span>
      </button>
      
          </div><!-- /.media-body -->
    
    <div class="sub-comments-box" id="sub-comments-box-23766" style="display:none">
      <div class="sub-comments media-list" id="comment-23766-sub">


  

</div>


<form action="http://www.atatech.org/comments/23766/subcomments/" method="POST" data-remote="true" data-target="#comment-23766-sub" data-done="$(&#39;#sub-comments-count-23766&#39;).inc()" class="sub-comment-form js-comment-create js-active-on-valid">
  <input type="hidden" name="isCheck" value="1">
    <div class="form-group">
    <textarea name="content" rows="1" class="form-control js-mention js-auto-expand" placeholder="写下你的评论…" onfocus="$(this).closest(&#39;form&#39;).addClass(&#39;active&#39;)" required=""></textarea>
  </div>
  <div class="form-group text-right actions">
    <button type="reset" class="btn btn-default btn-sm" onclick="$(this).closest(&#39;form&#39;).removeClass(&#39;active&#39;)">取消</button>
    <button type="submit" class="btn btn-primary btn-sm" disabled="">评论</button>
  </div>
</form>
    </div><!-- /.sub-comments-box -->
  </div>
  
  </div>
<div class="comment media gaze in" id="comment-23769">
  <div class="pull-left">
    <a href="http://www.atatech.org/users/75305" class="avatar">
      <img class="media-object img-circle" src="./iOS 内核驱动分析_files/u_identicon_4de69440e1cacc1dcd4051f9b89a1eff.png_120x120" width="42" height="42" alt="">
    </a>
        <span style="margin-left: 10px">
        7F
    </span>
      </div>
  <div class="media-body">
    <div class="source clearfix">
      <a href="http://www.atatech.org/users/75305" class="author">简行</a>
            <span class="pull-right small">
        <a href="http://www.atatech.org/articles/19071?rnd=598849306#comment-23769" class="link"><span class="glyphicon glyphicon-link"></span></a>
        <time class="js-relative-time" datetime="2014-07-11T15:01:44+08:00">2014-07-11 15:01:44</time>
      </span>
    </div>

    <div class="content unsafe">
      
<p>努力学习的榜样啊</p>

    </div>
    
    <div class="voters-p"></div>

    <div class="actions clearfix">
      <a href="http://www.atatech.org/comments/23769/voteup" title="赞" class="btn btn-link btn-sm action" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        0
      </a>
      <a href="http://www.atatech.org/comments/23769/unvoteup" title="取消赞" class="btn btn-link btn-sm action active" role="button" rel="nofollow" data-remote="true" data-method="post" data-done="$(this).closest(&#39;.comment&#39;).find(&#39;.voters-p:first&#39;).replaceWith(r);$(this).hide().siblings(&#39;:hidden&#39;).show()" style="display:none">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        1
      </a>
      <span class="sep"></span>
      <button class="btn btn-link btn-sm action" onclick="$(&#39;#sub-comments-box-23769&#39;).toggle()">
        <span class="glyphicon glyphicon-comment"></span> 
        <span id="sub-comments-count-23769">0</span>
      </button>
      
          </div><!-- /.media-body -->
    
    <div class="sub-comments-box" id="sub-comments-box-23769" style="display:none">
      <div class="sub-comments media-list" id="comment-23769-sub">


  

</div>


<form action="http://www.atatech.org/comments/23769/subcomments/" method="POST" data-remote="true" data-target="#comment-23769-sub" data-done="$(&#39;#sub-comments-count-23769&#39;).inc()" class="sub-comment-form js-comment-create js-active-on-valid">
  <input type="hidden" name="isCheck" value="1">
    <div class="form-group">
    <textarea name="content" rows="1" class="form-control js-mention js-auto-expand" placeholder="写下你的评论…" onfocus="$(this).closest(&#39;form&#39;).addClass(&#39;active&#39;)" required=""></textarea>
  </div>
  <div class="form-group text-right actions">
    <button type="reset" class="btn btn-default btn-sm" onclick="$(this).closest(&#39;form&#39;).removeClass(&#39;active&#39;)">取消</button>
    <button type="submit" class="btn btn-primary btn-sm" disabled="">评论</button>
  </div>
</form>
    </div><!-- /.sub-comments-box -->
  </div>
  
  </div>


<div class="comment-tip">
      
    
</div>
      </div>
      <script>require('comments')</script>

      <form accept-charset="UTF-8" action="http://www.atatech.org/comments" method="POST" data-remote="true" data-target="#comments" class="js-comment-create js-active-on-valid">
        <input type="hidden" name="type" value="article">
        <input type="hidden" name="isCheck" value="1">
        <input type="hidden" name="pid" value="19071">
        <div class="form-group">
          <div class="editor">
            <div class="editor-container">
              <div class="editor-actions">
                <button type="button" class="btn btn-xs editor-action js-editor-fullscreen" data-original-title="全屏">
                  <span class="glyphicon glyphicon-fullscreen"></span>
                </button>
                <button type="button" class="btn btn-xs editor-action js-editor-preview" data-original-title="预览">
                  <span class="glyphicon glyphicon-eye-open"></span>
                </button>
                <button type="button" class="btn btn-xs editor-action js-editor-upload" data-original-title="插入图片">
                  <span class="glyphicon glyphicon-picture"></span>
                </button>
              </div><!-- /.editor-actions -->
              <textarea name="content" rows="4" class="form-control js-mention js-auto-expand editor-content" id="comment" placeholder="写下你的评论…" required=""></textarea>
            </div><!-- /.editor-container -->

            <div class="editor-preview-container">
              <div class="editor-actions">
                <button type="button" class="btn btn-xs editor-action js-editor-preview-off" data-original-title="取消预览">
                  <span class="glyphicon glyphicon-eye-close"></span>
                </button>
              </div><!-- /.editor-actions -->
              <div class="editor-preview content unsafe" data-disable-with="&lt;span class=&quot;text-muted&quot;&gt;loading...&lt;/span&gt;"></div>
            </div><!-- /.editor-preview-container -->
          </div><!-- /.editor  -->
        </div>
        <div class="form-group text-right">
          <button type="submit" class="btn btn-primary" disabled="">评论</button>          
        </div>
      </form>
    </section><!-- /.comments -->

  </div><!-- /._article-box -->
</div></div><!-- /.container -->
        <footer class="footer" role="contentinfo">
  <div class="container">
	  <p class="copyright pull-left">
	  	© 2015 阿里巴巴集团 版权所有 Copyright© 15 ATA. All rights reserved.

	    <!-- cnzz PC-->
	    <script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_5837538'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s5.cnzz.com/stat.php%3Fid%3D5837538%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script><span id="cnzz_stat_icon_5837538"><a href="http://www.cnzz.com/stat/website.php?web_id=5837538" target="_blank" title="站长统计"><img border="0" hspace="0" vspace="0" src="./iOS 内核驱动分析_files/pic.gif"></a></span><script src="./iOS 内核驱动分析_files/stat.php" type="text/javascript"></script><script src="./iOS 内核驱动分析_files/core.php" charset="utf-8" type="text/javascript"></script>

	    <!-- cnzz 整站-->
	    <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254194462'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/stat.php%3Fid%3D1254194462%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script><span id="cnzz_stat_icon_1254194462"><a href="http://www.cnzz.com/stat/website.php?web_id=1254194462" target="_blank" title="站长统计"><img border="0" hspace="0" vspace="0" src="./iOS 内核驱动分析_files/pic.gif"></a></span><script src="./iOS 内核驱动分析_files/stat(1).php" type="text/javascript"></script><script src="./iOS 内核驱动分析_files/core(1).php" charset="utf-8" type="text/javascript"></script>
	    <!-- /cnzz -->
	    	  </p>
    <ul class="list-inline pull-right">
      <li><a href="http://www.atatech.org/articles/17702/" target="_blank">技术专题</a></li>
      <li><a href="http://www.atatech.org/articles/13783" target="_blank">如何玩转ATA2.0</a></li>
    </ul>
  </div>
</footer>
          <div id="modal-followers" class="modal fade" role="dialog" aria-labelledby="followers" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title">关注者</h4>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="submit" class="btn btn-primary">分享</button>
      </div>
    </div>
  </div>
</div><!-- /#modal-share -->  <div id="modal-share" class="modal fade" role="dialog" aria-labelledby="share" aria-hidden="true">
  <div class="modal-dialog">
    <form action="http://www.atatech.org/articles/#{id}/share" method="POST" data-remote="true" data-done="$(this).closest(&#39;.modal&#39;).modal(&#39;hide&#39;);$(&#39;#share-group-or-team&#39;).selectize({plugins: [&#39;remove_button&#39;]})[0].selectize.clear();$($(this).data(&#39;shareCountTarget&#39;)).inc();$.alert(&#39;分享成功&#39;, &#39;success&#39;)" class="js-active-on-valid" novalidate="">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title">分享</h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
            <a href="https://work.alibaba-inc.com/home?publicAccount=%E5%91%A8%E6%9C%AB%E4%BA%86%EF%BC%8C%E6%8E%A8%E8%8D%90%E4%B8%80%E7%AF%87ATA%E4%B8%8A%E7%9A%84%E5%B9%B2%E8%B4%A7%E5%B8%A6%E5%9B%9E%E5%AE%B6%E5%85%85%E5%85%85%E7%94%B5%E5%90%A7%3A-%29%EF%BC%81iOS+%E5%86%85%E6%A0%B8%E9%A9%B1%E5%8A%A8%E5%88%86%E6%9E%90%28http%3A%2F%2Fwww.atatech.org%2Farticles%2F19071%29" target="_blank">分享到阿里内外</a>
        </div>
        <div class="form-group">
            <label for="share-group">分享到我的团队/圈子</label>
                            
                        <select name="share-group-or-team[]" id="share-group-or-team" class="form-control selectized" autocomplete="off" placeholder="Groups or Teams" disabled="" tabindex="-1" style="display: none;"><option value="" selected="selected"></option></select><div class="selectize-control form-control single plugin-remove_button"><div class="selectize-input items not-full disabled locked"><input type="text" autocomplete="off" tabindex="" placeholder="没有可分享的团队或圈子" style="width: 158px;"></div><div class="selectize-dropdown form-control single plugin-remove_button" style="display: none;"><div class="selectize-dropdown-content"></div></div></div>
        </div>
        <div class="form-group">
          <label for="share-users">分享给同事</label>
          <input type="text" name="users" class="form-control js-user-complete" id="share-users" placeholder="Users" required="1">
        </div>
        <div class="form-group">
          <textarea name="content" rows="3" class="form-control" placeholder="羞羞的内容"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="submit" class="btn btn-primary" disabled="">分享</button>
      </div>
    </div>
    </form>
  </div>
</div><!-- /#modal-share -->
<script>require('modal-share')</script>
<script>
$('#share-group-or-team').selectize({
    plugins: ['remove_button']
})[0].selectize.clear();
</script>
  <div id="modal-tag-history" class="modal fade" role="dialog" aria-labelledby="tag history" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title">标签历史</h4>
      </div>
      <div class="modal-body">      
        <p class="text-muted">Loading...</p>
      </div>
    </div>
  </div>
</div><!-- /#modal-share -->
  <div id="modal-article-modify-history" class="modal fade" role="dialog" aria-labelledby="article modify history" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title">编辑历史</h4>
      </div>
      <div class="modal-body">      
        <p class="text-muted">Loading...</p>
      </div>
    </div>
  </div>
</div><!-- /#modal-share -->
        <script data-group-id="1183" data-user-id="79564">require('module/mention')</script>  <script data-group-id="1183" data-user-id="79564">require('module/user-complete')</script>  <script>require('module/tag-complete')</script>
  <script>require('module/editor')</script>
  <script>require('module/highlight')</script>
  <script src="./iOS 内核驱动分析_files/swfobject_modified.js"></script>
    <script>
  var _czc = _czc || [];
  var statistics_obj = {
  "article-recommend": ["文章", "相似文章"]
  };
  $('.cnzz-event a').on('click', function(){
    var id = $(this).parents('.cnzz-event').attr('id');
  _czc.push(["_trackEvent", statistics_obj[id][0], statistics_obj[id][1], "", "", id]);
  })
  </script>
    <script>
  $('.js-video').on('click', function(){

    if ($('#taobao-online-video').length > 0)
    {
      swfobject.registerObject("taobao-online-video");
    }
    
          setTimeout(function(){
        _czc.push(["_trackEvent", '文章', "iOS 内核驱动分析", "", "", 'article-19071']);
      }, 1000);
      })

  $(function(){

    $('body').append('<div id="article-outline"><div style="height:15px;"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button></div></div><style>#article-outline{display:none;min-width:140p;max-width: 200px; max-height: 350px;position:absolute;top:150px;left:-999px;border:1px solid #ccc;box-shadow:5px 5px 2px #ccc;padding: 5px 10px;background-color: #fff;overflow-y: auto;scroll-x: auto;}#article-outline ul{margin:5px 0 5px 0;padding-left:30px;font-size:12px;border-left:1px dotted #ccc;}#article-outline ul:first-child{padding-left:15px;border:none;}#article-outline li{list-style-type:decimal;margin:3px 0;}</style>')
    var jOutline = $('#article-outline');

    var jContent = $('article .content');
    var jContentHeight = jContent.height();
    jOutline.find('.close').on('click', function(){
      jOutline.hide();
    })

    updateOutline();

    var top = jOutline.offset().top;
    scrollOutline();
    $(window).on('scroll', scrollOutline);
    function scrollOutline() {
      var scrollTop = $(document).scrollTop();
      var maxTop = jContent.offset().top + jContent.height() - jOutline.height();
      if (scrollTop >= top && scrollTop <= maxTop)
      {
        jOutline.css({'position': 'fixed', 'top': 0});
      }
      else if(scrollTop < top)
      {
        jOutline.css({'position': 'absolute', 'top': '150px'});
      }
      else
      {
        jOutline.css({'position': 'absolute', 'top': maxTop+'px'});
      }

    }

    function updateOutline() {
        var arrAllHeader = jContent.find("h1,h2,h3,h4,h5,h6");
        var arrOutline = ['<ul>'];
        var header, headerText;
        var id = 0;
        var level = 0,
            lastLevel = 1;
        var levelCount = 0;
        for (var i = 0, c = arrAllHeader.length; i < c; i++) {
            header = arrAllHeader[i];
            headerText = $(header).text();

            header.setAttribute('id', id);

            level = header.tagName.match(/^h(\d)$/i)[1];
            levelCount = level - lastLevel;

            if (levelCount > 0) {
                for (var j = 0; j < levelCount; j++) {
                    arrOutline.push('<ul>');
                }
            } else if (levelCount < 0) {
                levelCount *= -1;
                for (var j = 0; j < levelCount; j++) {
                    arrOutline.push('</ul>');
                }
            };
            arrOutline.push('<li>');
            arrOutline.push('<a href="#' + id + '">' + headerText + '</a>');
            arrOutline.push('</li>');
            lastLevel = level;
            id++;
        }
        arrOutline.push('</ul>')
        if(arrOutline.length > 2){
            jOutline.append(arrOutline.join(''));
            jOutline.find('ul').each(function(i,n){
                var jThis = $(this);
                if(jThis.children('li').length === 0){
                    jThis.replaceWith(jThis.children());
                }
            });
            showOutline();
        }
        else {
            hideOutline();
        }
    }

    function showOutline() {
        var offset = jContent.offset();

        jOutline.css({
            left: offset.left + jContent.width() + 10 + 'px',
        }).show();
    }

    function hideOutline(){
        jOutline.hide();
    }
});
  </script>
  
    <a href="http://www.atatech.org/articles/19071?rnd=598849306#" class="go-top" style=""><span class="glyphicon glyphicon-arrow-up"></span></a>
<script>require('module/go-top')</script>        <a href="https://work.alibaba-inc.com/work/group/8401" target="_blank" title="为ATA2.0提供反馈" style="position:fixed;right:0;bottom:100px;" class="hidden-xs">
  <img src="./iOS 内核驱动分析_files/T17D1tFrVeXXcUfo_w-30-100.png" alt="">
</a>        <script type="text/javascript">
    $('.form-submit-btn').click(function(){
      $(this).parents('form').submit();
    });
    //导航 dropdown
    (function(){
    var t;
    $('.dropdown').hover(function(){
      var that = $(this);
      that.siblings().find('.dropdown-menu').hide();
      that.children('.dropdown-menu').show();
      clearTimeout(t);
    }, function(){
      var that = $(this);
      t = setTimeout(function(){
        that.children('.dropdown-menu').hide();
      }, 500)
      
    })
    }())
    </script>
  

<div class="alert-container"></div><div id="article-outline" style="left: 1160px; display: block; position: fixed; top: 0px;"><div style="height:15px;"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button></div><ul><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#0">1.内核驱动模块与用户态的交互</a></li><ul><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#1">1.1    IOKit</a></li><ul><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#2">1.1.1  IOKit介绍</a></li><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#3">1.1.2 与内核驱动通讯的API</a></li></ul><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#4">1.2    从一个内核驱动漏洞开始</a></li><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#5">1.3接下来讨论</a></li></ul><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#6">2.内核Cache获取</a></li><ul><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#7">2.1静态内核Cache提取原理</a></li><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#8">2.2具体操作会用到的工具</a></li></ul><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#9">3.内核反编译分析</a></li><ul><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#10">3.1内核Mach-O Over View</a></li><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#11">3.2内核驱动派遣函数定位原理</a></li><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#12">3.3IOUSBDeviceFamily派遣函数分析</a></li><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#13">3.4派遣函数表</a></li></ul><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#14">4.驱动Fuzzing准备</a></li><li><a href="http://www.atatech.org/articles/19071?rnd=598849306#15">4.最后</a></li></ul></div><style>#article-outline{display:none;min-width:140p;max-width: 200px; max-height: 350px;position:absolute;top:150px;left:-999px;border:1px solid #ccc;box-shadow:5px 5px 2px #ccc;padding: 5px 10px;background-color: #fff;overflow-y: auto;scroll-x: auto;}#article-outline ul{margin:5px 0 5px 0;padding-left:30px;font-size:12px;border-left:1px dotted #ccc;}#article-outline ul:first-child{padding-left:15px;border:none;}#article-outline li{list-style-type:decimal;margin:3px 0;}</style></body></html>